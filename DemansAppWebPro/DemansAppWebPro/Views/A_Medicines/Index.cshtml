﻿@{
    ViewData["Title"] = "Medicines";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section css{
    <link href="~/plugins/timepicker/bootstrap-material-datetimepicker.css" rel="stylesheet" />
    <style type="text/css">
        .table_style {
            overflow: auto;
            max-width: 150px;
            text-align: center;
        }

        .table_style {
            text-align: center !important
        }

        div.dataTables_wrapper div.dataTables_length select {
            width: 50px !important;
        }

        div.dataTables_wrapper div.dataTables_length label {
            margin-left: 10px !important;
            margin-top: 13px !important;
        }

        div.dataTables_wrapper div.dataTables_info {
            margin-left: 10px !important;
        }

        div.dataTables_wrapper div.dataTables_filter input {
            margin-right: 10px !important;
            margin-top: 13px !important;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button {
            padding: 2px !important
        }

        div.dataTables_wrapper div.dataTables_paginate {
            margin-right: 10px !important
        }

        .modal-input-style {
            margin-left: 10px !important;
        }

        .modal-label-style {
            padding-left: 20px !important;
        }

        .textarea-style {
            width: 71% !important;
            margin-left: 18px !important;
        }

        .label-style {
            padding-left: 20px !important;
            padding-top: 6px !important;
        }

        .checkbox {
            padding-left: 20px !important;
        }

        .dropdown-style {
            height: 35px !important;
            border-radius: 7px !important;
            border-color: darkgrey;
        }

        label {
            font-size: 14px !important;
            color: #303e67 !important;
            font-weight: 600 !important;
        }

        .medicine-time {
            margin-top: -6px !important;
        }

        .date-style {
            margin-left: -6px !important;
        }

    </style>
}

<div class="card">
    <div class="card-header">
        <div class="row text-center">
            <h3 class="page-title col-sm-10">İlaçlar</h3>
            <button type="button" class="btn btn btn-outline-dark col-sm-2 align-self-end" data-bs-toggle="modal" onclick="javascripts: showModal();">İlaç Ekle</button>
        </div>
    </div>
</div>
<div class="card">
    <div class="table-responsive">
        <table id="medicine_table" class="table table-striped table-bordered dt-responsive nowrap" style="vertical-align:middle; width:100%;">
            <thead>
                <tr>
                    <th class="table-style">Id</th>
                    <th class="table-style">İlaç Adı</th>
                    <th class="table-style">Kullanım Amacı</th>
                    <th class="table-style">Düzenle/Sil</th>
                    <th class="table-style">Kullanıcılar</th>
                    <th class="table-style">Kullanıcı Ekle</th>
                </tr>
            </thead>
        </table>
    </div>
</div>
<div class="card-body">
</div><!--end Medicine Table-->
<div class="modal fade" id="medicinesModal" data-bs-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="medicinesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal_style" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title m-0" id="medicinesModalLabel">İlaç Ekle / Güncelle</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal" onclick="reload();" aria-label="Close"></button>
            </div><!--end modal-header-->
            <div class="modal-body">
                <form id="medicinesAddOrUpdate-form">
                    <input type="hidden" value="0" id="AddOrUpdateId" name="AddOrUpdateId" />

                    <div class="mb-3 row">
                        <label for="ilacAdi" class="modal-label-style col-sm-3 form-label align-self-center mb-lg-0 ">İlaç Adı</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control modal-input-style" id="ilacAdi" placeholder="ilaç Adı">
                        </div>
                    </div>
                    <div class="mb-3 row">

                        <label class="col-sm-3 label-style" for="usage_duration">Kullanım Amacı</label>
                        <textarea type="text" class="form-control col-sm-9 textarea-style" id="usage_duration" name="usage_duration" maxlength="200" required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success btn-sm" onclick="javascript:getUpdateOrAdd();">TAMAM</button>
                <button type="button" class="btn btn-primary btn-sm" onclick="reload();" data-bs-dismiss="modal">VAZGEÇ</button>
            </div>
        </div>
    </div>
</div><!--end AudioBook's Modal-->

<div class="modal fade" id="usersModal" data-bs-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="usersModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal_style" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title m-0" id="usersModalLabel">Kullanıcıların İlaç Kullanım Bilgisi</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal" onclick="document.location.reload(true);" aria-label="Close"></button>
            </div><!--end modal-header-->
            <div class="modal-body">
                <form id="users-form">
                    <input type="hidden" value="0" id="medicineId" name="medicineId" />
                    <div class="card">
                        <div class="table-responsive">
                            <table id="users_table" class="table table-striped table-bordered dt-responsive nowrap" style="vertical-align:middle; width:100%;">
                                <thead>
                                    <tr>
                                        <th class="table-style">Ad Soyad</th>
                                        <th class="table-style">Kullanım Günleri</th>
                                        <th class="table-style">Kullanım Süresi</th>
                                        <th class="table-style">Kulanım Saati</th>
                                        <th class="table-style">Kullanıcı Çıkar</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary btn-sm" onclick="document.location.reload(true);" data-bs-dismiss="modal">TAMAM</button>
            </div>
        </div>
    </div>
</div><!--end users Modal-->

<div class="modal fade" id="addUserModal" data-bs-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="addUserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal_style" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title m-0" id="addUserModalLabel">Kullanıcı Ekle</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal" onclick="reload();" aria-label="Close"></button>
            </div><!--end modal-header-->
            <div class="modal-body">
                <form id="userupdate-form">
                    <input type="hidden" value="0" id="userupdateId" name="userupdateId" />

                    <div class="mb-4 row userdropdown">
                        <label for="Dropdown1" class="modal-label-style col-sm-4 form-label align-self-center mb-lg-0">Kullanıcı</label>
                        <select class="col-sm-8 dropdown-control dropdown-style" id="Dropdown1" name="Dropdown1"></select>
                    </div>
                    <div class="mb-3 row">

                        <div class="checkbox checkbox-purple checkbox-circle col-sm-4 checkbox">
                            <div>
                                <input id="moon" type="checkbox">
                                <label for="moon">Sabah</label>

                            </div>
                        </div>
                        <div class="col-sm-8 row">
                            <label for="moonTime" class="col-sm-4">İlaç Saati</label>
                            <div class="col-sm-8 medicine-time">
                                <input type="time" class="form-control modal-input-style time-style" id="moonTime">
                            </div>
                        </div>

                    </div>
                    <div class="mb-3 row">
                        <div class="checkbox checkbox-purple checkbox-circle col-sm-4 checkbox">
                            <div>
                                <input id="afternoon" type="checkbox">
                                <label for="afternoon">Öğle</label>

                            </div>
                        </div>
                        <div class="col-sm-8 row">
                            <label for="afternoonTime" class="col-sm-4">İlaç Saati</label>
                            <div class="col-sm-8 medicine-time">
                                <input type="time" class="form-control modal-input-style time-style" id="afternoonTime">
                            </div>
                        </div>

                    </div>
                    <div class="mb-3 row">
                        <div class="checkbox checkbox-purple checkbox-circle col-sm-4 checkbox">
                            <div>
                                <input id="evening" type="checkbox">
                                <label for="evening">Akşam</label>
                            </div>
                        </div>
                        <div class="col-sm-8 row">
                            <label for="eveningTime" class="col-sm-4">İlaç Saati</label>
                            <div class="col-sm-8 medicine-time">
                                <input type="time" class="form-control modal-input-style time-style" id="eveningTime">
                            </div>
                        </div>

                    </div>
                    <div class="mb-3 row">
                        <div class="checkbox checkbox-purple checkbox-circle col-sm-4 checkbox">
                            <div>
                                <input id="night" type="checkbox">
                                <label for="night">Gece</label>
                            </div>
                        </div>
                        <div class="col-sm-8 row">
                            <label for="nightTime" class="col-sm-4">İlaç Saati</label>
                            <div class="col-sm-8 medicine-time">
                                <input type="time" class="form-control modal-input-style time-style" id="nightTime">
                            </div>
                        </div>

                    </div>
                    <div class="mb-3 row">
                        <label class="form-label col-sm-4" for="date1" style="padding-left:20px !important;">Başlangıç Tarihi</label>
                        <div class="col-sm-8">
                            <input class="form-control date-style" type="date" id="date1" name="date1">
                        </div>

                    </div>
                    <div class="mb-3 row">
                        <label class="form-label col-sm-4" for="date2" style="padding-left:20px !important;">Bitiş Tarihi</label>
                        <div class="col-sm-8">
                            <input class="form-control date-style" type="date" id="date2" name="date2">
                        </div>

                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success btn-sm" onclick="javascript:addUser();">TAMAM</button>
                <button type="button" class="btn btn-primary btn-sm" onclick="reload();" data-bs-dismiss="modal">VAZGEÇ</button>
            </div>
        </div>
    </div>
</div><!--end usersUpdate Modal-->
@section scripts {
    <script src="~/plugins/timepicker/bootstrap-material-datetimepicker.js"></script>
    <script type="text/javascript">

        var medicineTable = null;
        var userTable = null;

        var moonTime = true;
        var afternoonTime = true;
        var eveningTime = true;
        var nightTime = true;

        $((_$) => {

            showMedicines();
            reload();
            getDate();
            $('.time-style').prop('disabled', true);
        });

        var getDate = () => {
            var today = new Date();

            document.getElementById("date1").value = today.getFullYear() + '-' + ('0' + (today.getMonth() + 1)).slice(-2) + '-' + ('0' + today.getDate()).slice(-2);
            document.getElementById("date2").value = today.getFullYear() + '-' + ('0' + (today.getMonth() + 1)).slice(-2) + '-' + ('0' + today.getDate()).slice(-2);
        }

        $('#moon').click(function () {
            if (moonTime) {
                $('#moonTime').prop('disabled', false);
                moonTime = false;
            } else {
                $('#moonTime').prop('disabled', true);
                moonTime = true;
            }
        });
        $('#afternoon').click(function () {
            if (afternoonTime) {
                $('#afternoonTime').prop('disabled', false);
                afternoonTime = false;
            } else {
                $('#afternoonTime').prop('disabled', true);
                afternoonTime = true;
            }
        });
        $('#evening').click(function () {
            if (eveningTime) {
                $('#eveningTime').prop('disabled', false);
                eveningTime = false;
            } else {
                $('#eveningTime').prop('disabled', true);
                eveningTime = true;
            }
        });
        $('#night').click(function () {
            if (nightTime) {
                $('#nightTime').prop('disabled', false);
                nightTime = false;
            } else {
                $('#nightTime').prop('disabled', true);
                nightTime = true;
            }
        });

        var showModal = () => {
            $('#ilacAdi').val('');
            $('#usage_duration').val('');
            $('#AddOrUpdateId').val('');

            $('#medicinesModal').modal('show');
        }

        var reload = () => {
            document.getElementById("medicinesAddOrUpdate-form").reset();
        }

        var showMedicines = () => {
            if (medicineTable == null)
                medicineTable = $('#medicine_table').DataTable({
                    language: { url: '../dil.json' },
                    processing: true,
                    serverSide: true,
                    paging: true,
                    filter: true,
                    scrollCollapse: true,
                    orderMulti: true,
                    order: [[1, "asc"]],
                    ajax: {
                        url: '@Url.Action("ShowMedicines", "A_Medicines")',
                        type: "POST",
                        datatype: "json"
                    },
                    createdRow: function (row, data, dataIndex) {
                    },
                    columnDefs: [{ "defaultContent": "-", "targets": "_all" }],
                    columns: [
                        {
                            "className": "table_style",
                            "render": (data, type, row) => {
                                return row.Id;
                            }, "name": "Id"
                        },
                        {
                            "className": "table_style",
                            "render": (data, type, row) => {
                                return row.Name;
                            }, "name": "Name"
                        },
                        {
                            "className": "table_style",
                            "render": (data, type, row) => {
                                return row.UsageDuration;
                            }, "name": "UsageDuration",
                        },
                        {
                            "className": "table_style",
                            "render": function (data, type, row) {
                                return `<button type="button" class="btn btn btn-outline-dark pt-2" onclick="javascript:getsetModal(${row.Id})"><i class="dripicons-document-edit"></i></button>
                                                                                                                <button type="button" class="btn btn btn-outline-dark pt-2" onclick="javascript:deleteMedicines(${row.Id})"><i class="dripicons-trash"></i></button>`;
                            }, "name": "Id", "name": "Id"
                        },
                        {
                            "className": "table_style",
                            "render": function (data, type, row) {
                                return `<button type="button" class="btn btn btn-outline-dark pt-2" onclick="javascript: showUsersModal(${row.Id});"><i class="dripicons-user"></i></button>`;
                            }, "name": "Id"
                        },
                        {
                            "className": "table_style",
                            "render": function (data, type, row) {
                                return `<button type="button" class="btn btn btn-outline-dark pt-2" onclick="javascript: showaddUserModal(${row.Id});"><i class="dripicons-document-edit"></i></button>`;
                            }, "name": "Id", "name": "Id"
                        },
                    ],
                    fixedColumns: true,
                    scrollCollapse: true,
                    initComplete: function (settings, json) {
                        $('#medicine_table_filter input').unbind();
                        $('#medicine_table_filter input').bind('keyup', function (e) {
                            if (e.keyCode == 13) {
                                medicineTable.search(this.value).draw();
                            }
                        });

                        $('.dataTables_scrollBody').removeAttr('style').css({
                            'position': 'relative',
                            'overflow-y': 'auto',
                            'overflow-x': 'auto',
                            'width': '100%',
                            'max-height': ((window.innerHeight / 2) + 120) + 'px'
                        });

                    }

                })
        }

        var getUpdateOrAdd = () => {

            if (document.getElementById("AddOrUpdateId").value > 0) {
                javascript: updateMedicines();
            }
            else {
                javascript: addMedicines();
            }
        }

        var addMedicines = () => {

            var NameControl = $('[id = "ilacAdi"]').val();
            var UsageDurationControl = $('[id = "usage_duration"]').val();

            if (!NameControl || !UsageDurationControl) {
                Command: toastr["warning"]("Lütfen İlaç Adı / Kullanım Amacı bilgisini giriniz.", "Ekleme başarısız!")
                toastr.options = {
                    "closeButton": true,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": false,
                    "positionClass": "toast-top-right",
                    "preventDuplicates": false,
                    "onclick": null,
                    "showDuration": "300",
                    "hideDuration": "1000",
                    "timeOut": "8000",
                    "extendedTimeOut": "1000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                }
                return;
            }

            var formData = new FormData();
            formData.append('Name', NameControl);
            formData.append('UsageDuration', UsageDurationControl);

            $.ajax({
                type: 'POST',
                url: '@Url.Action("AddMedicines","A_Medicines")',
                data: formData,
                async: true,
                contentType: false,
                processData: false,
                success: data => {

                    if (data.Status == true) {

                        Command: toastr["success"]("Ekleme işlemi başarıyla gerçekleşti.")

                        toastr.options = {
                            "closeButton": false,
                            "debug": false,
                            "newestOnTop": false,
                            "progressBar": false,
                            "positionClass": "toast-top-right",
                            "preventDuplicates": false,
                            "onclick": null,
                            "showDuration": "300",
                            "hideDuration": "1000",
                            "timeOut": "8000",
                            "extendedTimeOut": "1000",
                            "showEasing": "swing",
                            "hideEasing": "linear",
                            "showMethod": "fadeIn",
                            "hideMethod": "fadeOut"
                        }
                        document.getElementById("medicinesAddOrUpdate-form").reset();

                        $('#medicinesModal').modal('hide');

                        if (medicineTable != null)
                            medicineTable.ajax.reload();
                    }
                    else {
                        Command: toastr["error"]("Ekleme işlemi gerçekleşemedi.'")

                        toastr.options = {
                            "closeButton": false,
                            "debug": false,
                            "newestOnTop": false,
                            "progressBar": false,
                            "positionClass": "toast-top-right",
                            "preventDuplicates": false,
                            "onclick": null,
                            "showDuration": "300",
                            "hideDuration": "1000",
                            "timeOut": "8000",
                            "extendedTimeOut": "1000",
                            "showEasing": "swing",
                            "hideEasing": "linear",
                            "showMethod": "fadeIn",
                            "hideMethod": "fadeOut"
                        }
                    }
                    $('#medicinesModal').modal('hide');
                },
            });
        }

        var getsetModal = (sId) => {

            $('#AddOrUpdateId').val("");
            $.getJSON('@Url.Action("GetMedicines", "A_Medicines")', { sId: sId }, (d, s) => {
                if (s === 'success') {
                    $('#ilacAdi').val(d.data.Name);
                    $('#usage_duration').val(d.data.UsageDuration);
                    $('#AddOrUpdateId').val(d.data.Id);
                    $('#medicinesModal').modal('show');
                }
            })
        }

        var updateMedicines = () => {

            var Id = document.getElementById("AddOrUpdateId").value;
            var Name = document.getElementById("ilacAdi").value;
            var UsageDuration = document.getElementById("usage_duration").value;

            if (!Name || !UsageDuration) {
                Command: toastr["warning"]("Lütfen İlaç Adı / Kullanım Amacı bilgisini giriniz.", "Ekleme başarısız!")
                toastr.options = {
                    "closeButton": true,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": false,
                    "positionClass": "toast-top-right",
                    "preventDuplicates": false,
                    "onclick": null,
                    "showDuration": "300",
                    "hideDuration": "1000",
                    "timeOut": "8000",
                    "extendedTimeOut": "1000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                }
                return;
            }
            var formData = new FormData(document.getElementById('medicinesAddOrUpdate-form'));
            formData.append('Id', Id);
            formData.append('Name', Name);
            formData.append('UsageDuration', UsageDuration);


            $.ajax({
                type: "POST",
                url: '@Url.Action("UpdateMedicines","A_Medicines")',
                data: formData,
                processData: false,
                contentType: false,
                cache: false,
                success: function (d) {
                    if (d.Status == true) {
                        console.log('Gelen -> ', d);

                        Command: toastr["success"]("Güncelleme işlemi başarıyla gerçekleşti.")

                        toastr.options = {
                            "closeButton": false,
                            "debug": false,
                            "newestOnTop": false,
                            "progressBar": false,
                            "positionClass": "toast-top-right",
                            "preventDuplicates": false,
                            "onclick": null,
                            "showDuration": "300",
                            "hideDuration": "1000",
                            "timeOut": "8000",
                            "extendedTimeOut": "1000",
                            "showEasing": "swing",
                            "hideEasing": "linear",
                            "showMethod": "fadeIn",
                            "hideMethod": "fadeOut"
                        }
                        if (medicineTable != null)
                            medicineTable.ajax.reload();
                    }
                    else {
                        Command: toastr["error"]("Güncelleme işlemi gerçekleşemedi.'")

                        toastr.options = {
                            "closeButton": false,
                            "debug": false,
                            "newestOnTop": false,
                            "progressBar": false,
                            "positionClass": "toast-top-right",
                            "preventDuplicates": false,
                            "onclick": null,
                            "showDuration": "300",
                            "hideDuration": "1000",
                            "timeOut": "8000",
                            "extendedTimeOut": "1000",
                            "showEasing": "swing",
                            "hideEasing": "linear",
                            "showMethod": "fadeIn",
                            "hideMethod": "fadeOut"
                        }
                    }
                },
            });
            if (medicineTable != null)
                medicineTable.ajax.reload();

            $('#medicinesModal').modal('hide');
        }

        var deleteMedicines = (delId) => {
            Swal.fire({
                title: 'Silmek istediğinize emin misiniz?',
                icon: 'question',
                showCancelButton: true,
                cancelButtonText: 'Hayır',
                confirmButtonColor: '#4a804d',
                cancelButtonColor: '#b22222',
                confirmButtonText: 'Evet'
            })
                .then((result) => {

                    if (result.value == true) {
                        $.getJSON('@Url.Action("DeleteMedicines","A_Medicines")', { pr: delId }, (d, s) => {
                            if (s === "success") {

                                if (d.Status == true) {
                                    medicineTable.ajax.reload();
                                    Command: toastr["success"]("Silme işlemi gerçekleşti.")

                                    toastr.options = {
                                        "closeButton": false,
                                        "debug": false,
                                        "newestOnTop": false,
                                        "progressBar": false,
                                        "positionClass": "toast-top-right",
                                        "preventDuplicates": false,
                                        "onclick": null,
                                        "showDuration": "300",
                                        "hideDuration": "1000",
                                        "timeOut": "8000",
                                        "extendedTimeOut": "1000",
                                        "showEasing": "swing",
                                        "hideEasing": "linear",
                                        "showMethod": "fadeIn",
                                        "hideMethod": "fadeOut"
                                    }
                                } else {
                                    Command: toastr["error"]("Silme işlemi gerçekleşemedi.")

                                    toastr.options = {
                                        "closeButton": false,
                                        "debug": false,
                                        "newestOnTop": false,
                                        "progressBar": false,
                                        "positionClass": "toast-top-right",
                                        "preventDuplicates": false,
                                        "onclick": null,
                                        "showDuration": "300",
                                        "hideDuration": "1000",
                                        "timeOut": "8000",
                                        "extendedTimeOut": "1000",
                                        "showEasing": "swing",
                                        "hideEasing": "linear",
                                        "showMethod": "fadeIn",
                                        "hideMethod": "fadeOut"
                                    }
                                }
                            }
                            if (medicineTable != null)
                                medicineTable.ajax.reload();
                        });
                    }
                });
        }

        var showUsersModal = (sId) => {

            $('#usersModal').modal('show');
            $('#medicineId').val(sId);
            showUsers(sId);
        }

        var showUsers = (sId) => {
            if (userTable != null) userTable = null;

            if (userTable == null)
                userTable = $('#users_table').DataTable({
                    language: { url: '../dil.json' },
                    processing: true,
                    serverSide: true,
                    paging: true,
                    filter: true,
                    scrollCollapse: true,
                    orderMulti: true,
                    order: [[0, "desc"]],
                    ajax: {
                        url: '@Url.Action("ShowUsers", "A_Medicines")',
                        type: "POST",
                        datatype: "json",
                        data: function (d) {
                            d.sId = sId
                        },
                    },
                    createdRow: function (row, data, dataIndex) {
                    },
                    columnDefs: [{ "defaultContent": "-", "targets": "_all" }],
                    columns: [
                        {
                            "render": (data, type, row) => {
                                var adSoyad = row.UserName + ' ' + row.Surname;
                                return adSoyad;
                            }, "name": "UserName", "name": "Surname"
                        },
                        {
                            "render": (data, type, row) => {
                                return row.UsageDay;
                            }, "name": "UsageDay"
                        },
                        {
                            "render": (data, type, row) => {
                                return row.UsageTime + " " + "gün";
                            }, "name": "UsageTime"
                        },
                        {
                            "render": (data, type, row) => {
                                return row.Time;
                            }, "name": "Time"
                        },
                        {
                            "className": "table_style",
                            "render": (data, type, row) => {
                                return `<button type="button" class="btn btn btn-outline-dark pt-2" onclick="javascript: deleteUser(${row.Id});"><i class="dripicons-exit"></i></button>`;

                            }, "name": "Id"
                        },
                    ],
                    fixedColumns: true,
                    scrollCollapse: true,
                    initComplete: function (settings, json) {
                        $('#userTablo_filter input').unbind();
                        $('#userTablo_filter input').bind('keyup', function (e) {
                            if (e.keyCode == 13) {
                                userTable.search(this.value).draw();
                            }
                        });

                        $('.dataTables_scrollBody').removeAttr('style').css({
                            'position': 'relative',
                            'overflow-y': 'auto',
                            'overflow-x': 'auto',
                            'width': '100%',
                            'max-height': ((window.innerHeight / 2) + 120) + 'px'
                        });
                    }
                });
        }

        var showaddUserModal = (sId) => {
            $('#userupdateId').val(sId);
            dropdown1(sId);
            $('#addUserModal').modal('show');
        }

        var dropdown1 = (sId) => {

            $.getJSON('@Url.Action("Dropdown1", "A_Medicines")', { sId: sId }, (d, s) => {

                for (var i = 0; i < d.data.length; i++) {
                    $('#Dropdown1').empty();
                    var s = s + '<option value="' + d.data[i].Id + '">' + d.data[i].UserName + ' ' + d.data[i].Surname + '</option>';
                }
                $("#Dropdown1").html(s);

            })
        }

        var addUser = () => {

            var medicineId = $('#userupdateId').val();
            var userId = $('#Dropdown1').val();
            var moonStatus = document.getElementById('moon').checked;
            var afternoonStatus = document.getElementById('afternoon').checked;
            var eveningStatus = document.getElementById('evening').checked;
            var nightStatus = document.getElementById('night').checked;
            var moonTimeValue = document.getElementById('moonTime').value;
            var afternoonTimeValue = document.getElementById('afternoonTime').value;
            var eveningTimeValue = document.getElementById('eveningTime').value;
            var nightTimeValue = document.getElementById('nightTime').value;
            var startdate = document.getElementById('date1').value;
            var enddate = document.getElementById('date2').value;

            var formData = new FormData();
            formData.append('MedicineId', medicineId);
            formData.append('UserId', userId);
            formData.append('Moon', moonStatus);
            formData.append('Afternoon', afternoonStatus);
            formData.append('Evening', eveningStatus);
            formData.append('Night', nightStatus);
            formData.append('MoonTime', moonTimeValue);
            formData.append('AfternoonTime', afternoonTimeValue);
            formData.append('EveningTime', eveningTimeValue);
            formData.append('NightTime', nightTimeValue);
            formData.append('StartDate', startdate);
            formData.append('EndDate', enddate);


            $.ajax({
                type: 'POST',
                url: '@Url.Action("AddUser","A_Medicines")',
                data: formData,
                async: true,
                contentType: false,
                processData: false,
                success: data => {

                    if (data.Status == true) {

                        Command: toastr["success"]("Ekleme işlemi başarıyla gerçekleşti.")

                        toastr.options = {
                            "closeButton": false,
                            "debug": false,
                            "newestOnTop": false,
                            "progressBar": false,
                            "positionClass": "toast-top-right",
                            "preventDuplicates": false,
                            "onclick": null,
                            "showDuration": "300",
                            "hideDuration": "1000",
                            "timeOut": "8000",
                            "extendedTimeOut": "1000",
                            "showEasing": "swing",
                            "hideEasing": "linear",
                            "showMethod": "fadeIn",
                            "hideMethod": "fadeOut"
                        }
                        document.getElementById("medicinesAddOrUpdate-form").reset();

                        $('#medicinesModal').modal('hide');
                    }
                    else {
                        Command: toastr["error"]("Ekleme işlemi gerçekleşemedi.'")

                        toastr.options = {
                            "closeButton": false,
                            "debug": false,
                            "newestOnTop": false,
                            "progressBar": false,
                            "positionClass": "toast-top-right",
                            "preventDuplicates": false,
                            "onclick": null,
                            "showDuration": "300",
                            "hideDuration": "1000",
                            "timeOut": "8000",
                            "extendedTimeOut": "1000",
                            "showEasing": "swing",
                            "hideEasing": "linear",
                            "showMethod": "fadeIn",
                            "hideMethod": "fadeOut"
                        }
                    }
                    $('#addUserModal').modal('hide');
                },
            });
        }

        var deleteUser = (delId) => {

            Swal.fire({
                title: 'Çıkarmak istediğinize emin misiniz?',
                icon: 'question',
                showCancelButton: true,
                cancelButtonText: 'Hayır',
                confirmButtonColor: '#4a804d',
                cancelButtonColor: '#b22222',
                confirmButtonText: 'Evet'
            })
                .then((result) => {
                    if (result.value == true) {
                        $.getJSON('@Url.Action("DeleteUser","A_Medicines")', { pr: delId }, (d, s) => {
                            if (s === "success") {
                                if (d.Status == true) {
                                    userTable.ajax.reload();

                                    Command: toastr["success"]("Silme işlemi gerçekleşti.")

                                    toastr.options = {
                                        "closeButton": false,
                                        "debug": false,
                                        "newestOnTop": false,
                                        "progressBar": false,
                                        "positionClass": "toast-top-right",
                                        "preventDuplicates": false,
                                        "onclick": null,
                                        "showDuration": "300",
                                        "hideDuration": "1000",
                                        "timeOut": "8000",
                                        "extendedTimeOut": "1000",
                                        "showEasing": "swing",
                                        "hideEasing": "linear",
                                        "showMethod": "fadeIn",
                                        "hideMethod": "fadeOut"
                                    }
                                } else {
                                    Command: toastr["error"]("Silme işlemi gerçekleşemedi.")

                                    toastr.options = {
                                        "closeButton": false,
                                        "debug": false,
                                        "newestOnTop": false,
                                        "progressBar": false,
                                        "positionClass": "toast-top-right",
                                        "preventDuplicates": false,
                                        "onclick": null,
                                        "showDuration": "300",
                                        "hideDuration": "1000",
                                        "timeOut": "8000",
                                        "extendedTimeOut": "1000",
                                        "showEasing": "swing",
                                        "hideEasing": "linear",
                                        "showMethod": "fadeIn",
                                        "hideMethod": "fadeOut"
                                    }
                                }
                            }
                            if (userTable != null)
                                userTable.ajax.reload();
                        });
                    }
                });
        }


    </script>
    }